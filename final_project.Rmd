---
title: "project_19_fit20"
author: "Xiaolin Zheng, Sheng Cao, Xiangting Ye, Tianjiao Gao"
date: "4/30/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

````{r}
library(tidyverse)
library(lubridate)
library(sf)
library(rnaturalearthdata)
library(rnaturalearth)
library(munsell)
library(patchwork)
library(tidymodels)
library(factoextra)
library(corrplot)
```

#Data Sources

For this analysis, we combine two data sources. The first one is The World Happiness Report 2019 and 2020, a landmark survey of the state of global happiness that ranks worldwide countries by how happy their citizens perceive themselves to be. Among the variables, the happiness score is a national average of the responses to the main life evaluation question asked in the Gallup World Poll (GWP), which uses the Cantril Ladder. Happiness score can be explained by the other six factors, namely  GDP per capita, Healthy Life Expectancy, Social support, Freedom to make life choices, Generosity, and Corruption Perception, which are also included in the dataset.

The second source is the database of variation in government responses to COVID-19 from 2020 to now collected by the Oxford COVID-19 Government Response Tracker (OXCGRT), providing a systematic cross-national, cross-temporal measure to understand how government responses have evolved over the full period of the diseaseâ€™s spread. It also offered the composition and calculation of several policy indices, among which we took advantage of 4 indices, namely government response index, containment and health index, stringency index and economic support index.

Github Repo: final_project


# Part I. Data cleaning

```{r}
# load the data
whs2019 <- read_csv("2019.csv")
whs2020 <- read_csv("2020.csv")
covid2020 <- read_csv("OxCGRT_withnotes_2020.csv")
```

```{r}
# Data cleaning for whs2019 dataset
  
  # Clean the variable names
  whs2019 <- whs2019 %>%
  janitor::clean_names()

  # Select the variables
  whs2019 <- whs2019 %>%
    select(country_name, regional_indicator, ladder_score, logged_gdp_per_capita, social_support, healthy_life_expectancy, freedom_to_make_life_choices, generosity, perceptions_of_corruption) %>%
    rename("happiness" = "ladder_score")
  
  # Delete the missing values
  whs2019 <- whs2019 %>%
    na.omit()

#write.csv(whs2019, file = "whs2019_update.csv")
```

```{r}
# Data cleaning for whs2020 dataset
  
  # Clean the variable names
  whs2020 <- whs2020 %>%
  janitor::clean_names()

  # Select the variables
  whs2020 <- whs2020 %>%
    select(country_name, regional_indicator, logged_gdp_per_capita, social_support, healthy_life_expectancy, freedom_to_make_life_choices, generosity, perceptions_of_corruption) 

  # Delete the missing values
  whs2020 <- whs2020 %>%
    na.omit()
  
```

```{r}
# Data cleaning for covid2020 dataset

  # clean the data variable name
  covid2020 <- covid2020 %>%
    janitor::clean_names()
  
  # select and rename variables
  covid2020 <- covid2020 %>%
    select(c("country_name", "country_code", "region_name", "stringency_index_for_display", "government_response_index_for_display", "containment_health_index_for_display", "economic_support_index_for_display")) %>%
    rename(
      "SI" = "stringency_index_for_display",
      "GRI" = "government_response_index_for_display",
      "CHI" = "containment_health_index_for_display",
      "ESI" = "economic_support_index_for_display"
        )
  
  # group by country
  covid2020 <- covid2020 %>%
    group_by(country_name, country_code) %>%
    summarize(
      SI = mean(SI, na.rm = TRUE),
      GRI = mean(GRI, na.rm = TRUE),
      CHI = mean(CHI, na.rm = TRUE),
      ESI = mean(ESI, na.rm = TRUE)
    )
```

```{r}
# create the country code index
code_index <- covid2020 %>%
  select(country_name, country_code)
```


```{r}
# add country code column to whs2019 so that we can match whs2019 to the geometry dataset using the country code
whs2019 <- whs2019 %>%
  left_join(code_index, by = "country_name")
```

```{r}
# add country code column to whs2019 so that we can match whs2019 to the geometry dataset using the country code
whs2020 <- whs2020 %>%
  left_join(code_index, by = "country_name")
```

# Part II. Data Visualzation  

### A.

```{r}
whs2019cor <- whs2019 %>%
  select_if(is.numeric)
```

```{r}
# computing correlation matrix
cor_whs <- cor(whs2019cor)
corrplot(cor_whs, method = "color") + 
  theme_void()
```
The heatmap represents the correlation between seven variables. They are happiness, logged gdp per capita, social support, healthy life expectancy, freedom to make life choices, generosity and perceptions of corruption respectively. Dark blue is the sign of strong positive correlation and dark red means strong negative correlation.  Happiness, logged gdp per capita, social support and healthy life expectancy have rather strong correlations with each other, for their covariances are all higher than 0.4. Perceptions of corruption are negatively correlated with other six variables and the covariances are located between -0.2 and -0.4.


### B.
 
```{r}
# load the world map data
world <- ne_countries(scale = "medium", returnclass = "sf")
```


```{r}
# clean the world map dataset
world_map <- world %>%
  select(admin, adm0_a3, geometry) %>%
  rename(
    "country_name" = "admin",
    "country_code" = "adm0_a3"
  ) %>%
  st_transform(crs = 4326)
```


```{r}
# match two dataset
whs2019_geometry <- left_join(world_map, whs2019, by = "country_code") %>%
  na.omit()
```


```{r}
# draw the hapiness index map
ggplot(whs2019_geometry) +
  geom_sf(aes(fill = happiness)) +
  scale_fill_distiller(palette = "YlOrBr") +
  theme_void() +
  labs(
    title = "Rich countries have higher level of happiness",
    subtitle = "2019",
    caption = "World Hapiness Report 2019"
  )

```
We only used World Happiness Report 2019 from the first dataset to draw a world map with the degree of happiness in 2019. In the map, dark orange stands for lower level of happiness, and vice versa. It is clear that North America, Western Europe and Australia where wealthy countries concentrate are endowed with much higher levels of happiness than those parts of the world with middle-income and low-income countries.

